:root {
  /* Primitive Colors - Tailwind Palette References */
  /* Blue */
  --p-primary-600: #2563eb;
  --p-primary-500: #3b82f6;
  --p-primary-400: #60a5fa;
  --p-primary-100: #dbeafe;

  /* Cool Gray */
  --p-gray-950: #030712;
  --p-gray-900: #111827;
  --p-gray-800: #1f2937;
  --p-gray-700: #374151;
  --p-gray-600: #4b5563;
  --p-gray-500: #6b7280;
  --p-gray-400: #9ca3af;
  --p-gray-300: #d1d5db;
  --p-gray-200: #e5e7eb;
  --p-gray-100: #f3f4f6;
  --p-gray-50:  #f9fafb;

  /* Status */
  --p-green-600: #16a34a;
  --p-green-500: #22c55e;
  --p-green-400: #4ade80;

  --p-red-600: #dc2626;
  --p-red-500: #ef4444;
  --p-red-400: #f87171;

  /* Semantic Tokens - Light Mode (Default) */
  --color-primary: var(--p-primary-600);
  --color-primary-text: #ffffff; /* Text on primary bg */
  
  --color-bg-body: var(--p-gray-50);
  --color-bg-subtle: var(--p-gray-100);
  --color-bg-card: #ffffff;
  --color-bg-input: var(--p-gray-100);
  --color-bg-hover: var(--p-gray-50);

  --color-text-body: var(--p-gray-900);
  --color-text-muted: var(--p-gray-500);
  --color-text-inverse: #ffffff;
  
  --color-border: var(--p-gray-200);
  --color-border-hover: var(--p-gray-300);
  --color-border-card: var(--p-gray-200);
  
  /* Header specific */
  --color-bg-header: var(--p-primary-600);
  --color-text-header: #ffffff;
  --color-header-border: transparent;
  
  /* Status */
  --color-success: var(--p-green-600);
  --color-danger: var(--p-red-600);
  
  /* Charts */
  --color-chart-text: var(--p-gray-700);
  --color-chart-grid: var(--p-gray-200);

  /* Chart Palette */
  --color-chart-1: #3B82F6;
  --color-chart-2: #EF4444;
  --color-chart-3: #10B981;
  --color-chart-4: #F59E0B;
  --color-chart-5: #6366F1;
  --color-chart-6: #EC4899;
  --color-chart-7: #8B5CF6;
  --color-chart-8: #0EA5E9;
  --color-chart-9: #22C55E;
  --color-chart-10: #EAB308;
  --color-chart-11: #818CF8;
  --color-chart-12: #D946EF;
  --color-chart-13: #A855F7;
}

.dark {
  /* Semantic Tokens - Dark Mode */
  --color-primary: var(--p-primary-500);
  --color-primary-text: #ffffff;

  --color-bg-body: var(--p-gray-900); /* deep dark */
  --color-bg-subtle: var(--p-gray-800);
  --color-bg-card: var(--p-gray-800);
  --color-bg-input: var(--p-gray-950); /* slightly darker than card for contrast */
  --color-bg-hover: var(--p-gray-700);

  --color-text-body: var(--p-gray-100);
  --color-text-muted: var(--p-gray-400);
  --color-text-inverse: var(--p-gray-900);
  
  --color-border: var(--p-gray-700);
  --color-border-hover: var(--p-gray-600);
  --color-border-card: var(--p-gray-700);
  
  /* Header specific - Match sidebar/dark theme */
  --color-bg-header: var(--p-gray-800);
  --color-text-header: var(--p-gray-100);
  --color-header-border: var(--p-gray-700);
  
  /* Status */
  --color-success: var(--p-green-400);
  --color-danger: var(--p-red-400);

  /* Charts */
  --color-chart-text: var(--p-gray-200);
  --color-chart-grid: var(--p-gray-700);
}

body {
  margin: 0;
  font-family: system-ui, -apple-system, sans-serif;
  background-color: var(--color-bg-body);
  color: var(--color-text-body);
  transition: background-color 0.2s, color 0.2s;
  -webkit-font-smoothing: antialiased;
}

/* Global Layout Utilities */
.page-container {
  width: 100%;
}

.page-title {
  font-size: 1.5rem; /* 24px */
  font-weight: 700;
  margin-bottom: 1.5rem;
  color: var(--color-text-body);
}

.section-title {
  font-size: 1.25rem; /* 20px */
  font-weight: 600;
  margin-bottom: 1rem;
  color: var(--color-text-body);
}

/* Form Input Overrides to ensure CSS variable usage */

/* Fix for SelectMenu input */
div[data-headlessui-state] input {
  color: var(--color-text-body) !important;
  background-color: var(--color-bg-input) !important;
}

/* Fix for all form inputs to use theme variables */
input:not([type="checkbox"]):not([type="radio"]),
textarea,
select {
  background-color: var(--color-bg-input) !important;
  color: var(--color-text-body) !important;
  border-color: var(--color-border) !important;
}

/* Override any .form-input rules that set white background */
.form-input,
.form-textarea,
.form-select,
.form-multiselect {
  background-color: var(--color-bg-input) !important;
  border-color: var(--color-border) !important;
  color: var(--color-text-body) !important;
}

/* Fix USelectMenu search input width and styling */
[data-headlessui-state="open"] input[type="search"],
[data-headlessui-state="open"] input[type="text"] {
  width: 100% !important;
  box-sizing: border-box !important;
  background-color: var(--color-bg-input) !important;
  color: var(--color-text-body) !important;
  border-color: var(--color-border) !important;
}

/* Style search input placeholder */
[data-headlessui-state="open"] input[type="search"]::placeholder,
[data-headlessui-state="open"] input[type="text"]::placeholder {
  color: var(--color-text-muted) !important;
}

/* Fix mobile keyboard issue for dropdowns - top-half modal to avoid keyboard overlap */
@media (max-width: 768px) {
  /* Reset any transforms on all elements that could interfere with fixed positioning */
  [data-headlessui-state="open"] * {
    transform: none !important;
    perspective: none !important;
    filter: none !important;
  }

  /* Target the dropdown panel itself - this is what Headless UI creates */
  [data-headlessui-state="open"] [role="listbox"],
  [data-headlessui-state="open"] [role="menu"],
  [data-headlessui-state="open"] [role="dialog"] {
    position: fixed !important;
    top: 3.5rem !important; /* Account for header height (approx 56px) */
    left: 0 !important;
    right: 0 !important;
    max-height: calc(50vh - 3.5rem) !important; /* Adjust height to account for header */
    height: calc(50vh - 3.5rem) !important;
    /* Container doesn't scroll by itself, child elements scroll */
    z-index: 9999 !important;
    margin: 0 !important;
    border-radius: 0 0 0.75rem 0.75rem !important;
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important;
    transform: none !important;
    background-color: var(--color-bg-card) !important;
    border: 1px solid var(--color-border) !important;
    display: flex !important;
    flex-direction: column !important;
  }

  /* Ensure search input is visible and functional - at top of modal */
  [data-headlessui-state="open"] input[type="search"],
  [data-headlessui-state="open"] input[type="text"] {
    width: 100% !important;
    box-sizing: border-box !important;
    background-color: var(--color-bg-card) !important;
    border-bottom: 1px solid var(--color-border) !important;
    padding: 1rem !important;
    font-size: 1rem !important;
    margin: 0 !important;
    -webkit-appearance: none !important; /* Remove iOS styling */
    border-radius: 0 !important; /* Remove iOS styling */
    flex-shrink: 0 !important; /* Don't shrink */
  }

  /* Target ul elements for scrolling - Headless UI often uses ul for listboxes */
  [data-headlessui-state="open"] [role="listbox"] ul,
  [data-headlessui-state="open"] [role="menu"] ul,
  [data-headlessui-state="open"] [role="dialog"] ul {
    flex-grow: 1 !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    margin: 0 !important;
    padding: 0 !important;
    list-style: none !important;
    max-height: 100% !important; /* Ensure it has a height constraint */
    min-height: 0 !important; /* Important for flex children to respect overflow */
  }

  /* Target any element that might be the options container */
  /* Use a simpler selector without :has() */
  [data-headlessui-state="open"] [role="listbox"] > *:last-child,
  [data-headlessui-state="open"] [role="menu"] > *:last-child,
  [data-headlessui-state="open"] [role="dialog"] > *:last-child {
    flex-grow: 1 !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch !important;
    max-height: 100% !important;
    min-height: 0 !important;
  }

  /* Ensure search input (usually first child) doesn't grow */
  [data-headlessui-state="open"] [role="listbox"] > *:first-child,
  [data-headlessui-state="open"] [role="menu"] > *:first-child,
  [data-headlessui-state="open"] [role="dialog"] > *:first-child {
    flex-grow: 0 !important;
    flex-shrink: 0 !important;
  }

  /* Make dropdown options more touch-friendly */
  [data-headlessui-state="open"] [role="option"],
  [data-headlessui-state="open"] [role="menuitem"] {
    padding: 0.75rem 1rem !important;
    min-height: 44px !important; /* Minimum touch target size */
    font-size: 1rem !important;
    cursor: pointer !important;
    border-bottom: 1px solid var(--color-border) !important;
  }

  /* Remove border from last option */
  [data-headlessui-state="open"] [role="option"]:last-child,
  [data-headlessui-state="open"] [role="menuitem"]:last-child {
    border-bottom: none !important;
  }

  /* Improve focus states for mobile */
  [data-headlessui-state="open"] [role="option"]:focus,
  [data-headlessui-state="open"] [role="option"]:hover,
  [data-headlessui-state="open"] [role="menuitem"]:focus,
  [data-headlessui-state="open"] [role="menuitem"]:hover {
    background-color: var(--color-bg-hover) !important;
  }

  /* Backdrop for bottom half of screen - using body pseudo-element */
  body.dropdown-open::after {
    content: '';
    position: fixed !important;
    top: 50vh !important; /* Start at bottom of modal */
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    background-color: rgba(0, 0, 0, 0.3) !important;
    z-index: 9998 !important;
    pointer-events: auto !important; /* Allow clicks to close dropdown */
  }

  /* Prevent body scroll when dropdown is open */
  body.dropdown-open {
    overflow: hidden !important;
    position: fixed !important;
    width: 100% !important;
  }
}
